{"componentChunkName":"component---src-templates-course-content-template-js","path":"/luku-8/1-muistihierarkia","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"lead","properties":{},"children":[{"type":"text","value":"Tässä aliluvussa kertaamme ensin muistihierarkian käsitteen. Useat järjestelmän laitteisto- ja ohjelmistoratkaisut ovat ratkaisuja muistihierarkiasta. Esittelemme sitten keskusmuistin ja levymuistin suuria koko- ja nopeuseroja tasoittavan virtuaalimuistin perustoiminnon."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Muistihierarkia"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tietoa talletetaan tietokonejärjestelmiin hyvin monella eri tasolla. Lähtökohta eri tasojen käytölle on periaate, että pienempi muisti on nopeampaa ja suurempi muisti on halvempi toteuttaa. Tämä on johtanut muistihierarkiaan, jonka olennaisia osia illustroitiin Juustokakkuesimerkillä (ks. luku 1)."}]},{"type":"comment","value":" kuva: ch-1-3-muistihierarkia    "},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"/45d76cc31ff67658eccdf1c352d5fd64/ch-1-3-muistihierarkia.svg","alt":"Kolme sisäkkäistä aluetta. Sisimpänä on laitteisto, jossa on rekisterit, muisti ja niiden välissä välimuistit. Nuoli menee muistista välimuistien läpi rekistereihin. Keskellä on järjestelmätaso, jolla on laitteisto, massamuisti ja niiden välissä käyttöjärjestelmän ylläpitämä virtuaalimuisti ja levyvälimuisti. Nuoli menee massamuistista virtuaalimuistin ja levyvälimuistin läpi muistiin. Uloin alue on internet, jossa on tämä järjestelmän, pilvipalvelu/www ja niiden välissä välityspalvelin eli proxy. Nuoli pilvipalvelusta proxyn kautta massamuistiin. Laitteiston nopeus on ns-luokkaa, järjestelmän massamuistin nopeus ms-luokkaa. Pilvipalveluiden ja muun internetin nopeus on sekuntien luokkaa."},"children":[]}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"illustrations","properties":{"motive":"ch-1-3-muistihierarkia","frombottom":"0","totalheight":"100%"},"children":[]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Muistihierarkiassa on kolme selkeää tasoa. Sisimpänä ovat suorittimen kanssa samalla piirikortilla toteutetut muistit, keskimmäisellä tasolla yhdessä järjestelmässä (samassa kotelossa?) olevat nopeahkot muistit. Uloimpana verkossa olevat tai samassa järjestelmässä olevat hyvin hitaat laitteet."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kaikkien sisimpänä samalla mikropiirillä suorittimen laiterekistereiden kanssa ovat nopeimmat välimuistit. Esimerkiksi, nopeimmat tason L1 ja L2 välimuistit voivat olla toteutettuna samalla mikropiirillä suorittimen kanssa, mutta vähän hitaammat tason L3 ja L4 välimuistit voivat sijaita omilla mikropiireillään välittömästi suorittimen vieressä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Keskusmuisti sijaitsee samalla piirikortilla ("},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Emolevy","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"emolevyllä"}]},{"type":"text","value":") suorittimen kanssa ja on yhteydessä siihen väylän kautta. Keskusmuistin käyttö on huomattavasti (esim. 50x) hitaampaa kuin rekistereiden, mutta keskusmuisti on kooltaan huomattavasti suurempi (esim. 1 GB) kuin rekisterijoukko (esim. 0.5 MB). Välimuistiteknologian avulla keskusmuisti saadaan tuntumaan lähes yhtä nopealta kuin rekisterit."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Massamuistilaitteet (esim. kovalevy, SSD-levy, CD-levy, DVD-levy, Blu-ray-levy, USB-muistitikku) sijaitsevat samassa järjestelmässä ja niitä voi käyttää järjestelmän väylähierarkian kautta. Eri nopeuksiset väylät muodostavat hierarkian ja kullekin laitetyypille on sille sopivan nopeuksinen väylä. Hitaammat väylät liitetään erityisen sovittimen kautta nopeampiin, jotta ne eivät hidastaisi nopeampien väylien toimintaa. Massamuistit toimivat ms-aikaskaalassa eli ne ovat suuruusluokkaa 10"},{"type":"element","tagName":"sup","properties":{},"children":[{"type":"text","value":"6"}]},{"type":"text","value":" hitaampia kuin suoritin."}]},{"type":"comment","value":" Kuva: ch-1-1-vaylahierarkia "},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"/78bc2e9a9a75cea9883f9a98b7d415aa/ch-1-1-vaylahierarkia.svg","alt":"Nopein väylä on sisäinen väylä suorittimen ja välimuistin välillä. Seuraavaksi nopein muistiväylä yhdistää välimuistin muistiin. Muistiväylässä on myös sovitin vähän hitaammalle PCI-väylälle, jossa on kiinni kovalevy. PCI-väylässä on myös sovitin vielä hitaammalle USB-väylälle, jossa on kiinni USB-muistitikku ja näppäimistö."},"children":[]}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"illustrations","properties":{"motive":"ch-1-1-vaylahierarkia","frombottom":"0","totalheight":"40%"},"children":[]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Uusi flash-teknologiaan perustuva "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/SSD","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"SSD"}]},{"type":"text","value":" (Solid State Disk) -massamuisti on usein vielä toteutettu kovalevyn lailla ulkoisena massamuistina, mutta se voi sijaita myös valmiiksi asennettuna emolevyllä. SSD-massamuisti on yleensä toteutettu niin, että se näyttää samalta kuin pyörivä kovalevy, vaikka onkin selvästi nopeampi (esim. 10x). Samasta teknologiasta on myös nopeampi versio, "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/NVM_Express","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"NVMe"}]},{"type":"text","value":" (NVM Express, Non-Volatile Memory). SSD:ssä (ja NVMe:ssä) on nopeuden lisäksi suurena etuna kovalevyyn verrattuna se, että siinä ei ole helposti vikaantuvia liikkuvia osia."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ihmisen kanssa kommunikointiin tarkoitetut laitteet (esim. näppäimistö tai hiiri) kuuluvat myös järjestelmän \"sisäisiin\" laitteisiin, mutta ne ovat yleensä vielä monta kertaluokkaa hitaampia kuin massamuistit. Yleensä ihminen toimii sekunnin aikaskaalassa, mutta joiden graafisten käyttöliittymien kautta toiminta voi olla huomattavasti nopeampaa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Järjestelmän ulkopuoliset muistit toimivat nekin sekunnin aikaskaalassa, koska tiedon siirtoon verkon läpi kuluu niin paljon aikaa. Tällaisia muistijärjestelmiä ovat organisaatioiden omat levypalvelimet ja erilaiset internetin pilvipalvelimet. Teoriassa tiedon hakeminen maapallon toiselta puolelta kestää tietenkin aika kauan aikaa, mutta käytännössä tieto haetaan useimmiten lähempänä olevasta www-välimuistista."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jotkut järjestelmän laitteet (esim. magneettinauha) ovat yhtä hitaita kuin järjestelmän ulkopuoliset muistit ja niitä käsitellään myös samalla tavalla. Jako järjestelmän sisäisiin ja ulkoisiin laitteisiin on keinotekoinen - parempi tapa olisi luokitella laitteita niiden sijainnin mukaan väylähierarkiassa."}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Virtuaalimuisti"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Käytännössä ohjelman suorituksen aikana tiedot tulee säilyttää joko keskusmuistissa tai massamuistissa. Massamuisti on voi olla tuhat kertaa niin suuri kuin keskusmuisti, kun taas keskusmuisti voi olla miljoona kertaa niin nopea kuin massamuisti. Käyttöjärjestelmän "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/N%C3%A4enn%C3%A4ismuisti","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"virtuaalimuistiteknologia"}]},{"type":"text","value":" (virtual memory) antaa ohjelman käyttöön näennäisen muistialueen, joka on lähes yhtä nopea kuin keskusmuisti, mutta yhtä suuri kuin massamuisti."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Virtuaalimuisti on toteutettu kaikissa nykyisissä yleiskäyttöisissä käyttöjärjestelmissä (esim. Windows, Linux ja MacOS). Ratkaisu on kaksitasoinen. Kaikki ohjelman tiedot pidetään massamuistissa (virtuaalimuistin "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"tukimuistissa"}]},{"type":"text","value":") ja vain kulloinkin tarvittavat muistialueet pidetään keskusmuistissa. Tietoja kopioidaan yksi muistilohko eli "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"sivu"}]},{"type":"text","value":" (page) kerrallaan aina tarvittaessa keskusmuistin ja tukimuistin välillä sillä tavoin, että lähes aina viitatut muistialueet löytyvät keskusmuistista. Ei tietenkään ole mitenkään yksinkertaista ennustaa etukäteen, mitä muistialueita kukin ohjelma tarvitsee keskusmuistiin lähitulevaisuudessa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jos ohjelma suoritusaikana viittaa muistipaikkaan, joka ei ole keskusmuistissa, tapahtuu "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"sivunpuutoskeskeytys"}]},{"type":"text","value":" (page fault). Se on yksi etukäteen määritellyistä keskeytystyypeistä. Sivunpuutoskeskeytyksen yhteydessä sen aiheuttanut prosessi siirretään odotustilaan ja viitattu muistialue (ja sen lähialueita) kopioidaan tukimuistista keskusmuistiin, minkä jälkeen kyseinen prosessi pääsee takaisin suoritukseen. Tällöin se suorittaa saman konekäskyn uudelleen, mutta tällä kertaa viitattu tieto löytyy keskusmuistista. Tähän kaikkeen kuluu suhteellisesti ottaen hyvin paljon aikaa, mutta toivottavasti sivunpuutoskeskeytyksiä ei tapahdu kovin usein."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jokaisen muistiviitteen kohdalla täytyy siis tarkistaa, onko viitattu muistialue keskusmuistissa ja missä siellä se mahdollisesti sijaitsee. Tällaista osoitteenmuunnosta ei voi tehdä yleensä ohjelmallisesti (usealla konekäskyllä), koska se hidastaisi suoritusta liikaa. Osoitteenmuunnosten tekemiseen nopeasti suorittimella (sen "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Memory_management_unit","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"MMU"}]},{"type":"text","value":":ssa) on oma erityislaitteistonsa, "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Translation_lookaside_buffer","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"TLB"}]},{"type":"text","value":" (Translation Lookaside Buffer), joka toimii välimuistin tavoin. Useimmiten osoitteenmuunnos löytyy TLB:stä, mikä tekee virtuaalimuistijärjestelmien toiminnan mahdolliseksi. "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"TLB-hudin"}]},{"type":"text","value":" (TLB miss) yhteydessä osoitteenmuunnos täytyy tehdä tavallisilla konekäskyillä muistissa olevia osoitteenmuunnostaulukoita ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"sivutaulu"}]},{"type":"text","value":" tai "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"segmenttitaulu"}]},{"type":"text","value":") käyttäen. Samalla tietenkin kopioidaan tehty osoitteenmuunnos TLB:hen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Virtuaalimuistin toteutuksessa on muutamia eri tapoja. Yleensä tukimuistista kopioidaan vakiokokoisia muistilohkoja ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"sivuja"}]},{"type":"text","value":") kerrallaan ja muistilohkojen koko (sivun koko) sopii hyvin yhteen käytössä olevan tukimuistin toteutukseen. Toinen vaihtoehto on tehdä kerralla kopioitavista muistilohkoista vaihtelevan kokoisia "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"segmenttejä"}]},{"type":"text","value":", jolloin ne taas sopivat paremmin yhteen prosessien hallinnoimien eri kokoisten muistialueiden (esim. "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"koodisegmentti"}]},{"type":"text","value":", "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"datasegmentti"}]},{"type":"text","value":" tai "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"pino"}]},{"type":"text","value":") kanssa. Osoitteenmuunnos voidaan toteuttaa monitasoisena, jolloin siinä voi olla sekaisin "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"segmentointia"}]},{"type":"text","value":" ja "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"sivutusta"}]},{"type":"text","value":". Lisäksi osoitteenmuutokseen voi liittyä aikaisemmin esitetty kanta- ja rajarekistereiden käyttö."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Virtuaalimuistin toteutukseen liittyy huomattava määrä käyttöjärjestelmän ohjelmistoa, mutta emme käsittele sitä tällä kurssilla tämän enempää. Virtuaalimuistijärjestelmän toiminta esitellään tarkemmin yliopiston käyttöjärjestelmäkurssilla."}]}]},"html":"<div><div>\n<lead>Tässä aliluvussa kertaamme ensin muistihierarkian käsitteen. Useat järjestelmän laitteisto- ja ohjelmistoratkaisut ovat ratkaisuja muistihierarkiasta. Esittelemme sitten keskusmuistin ja levymuistin suuria koko- ja nopeuseroja tasoittavan virtuaalimuistin perustoiminnon.</lead>\n</div><h2>Muistihierarkia</h2><p>Tietoa talletetaan tietokonejärjestelmiin hyvin monella eri tasolla. Lähtökohta eri tasojen käytölle on periaate, että pienempi muisti on nopeampaa ja suurempi muisti on halvempi toteuttaa. Tämä on johtanut muistihierarkiaan, jonka olennaisia osia illustroitiin Juustokakkuesimerkillä (ks. luku 1).</p><!-- kuva: ch-1-3-muistihierarkia    --><p><img src=\"/45d76cc31ff67658eccdf1c352d5fd64/ch-1-3-muistihierarkia.svg\" alt=\"Kolme sisäkkäistä aluetta. Sisimpänä on laitteisto, jossa on rekisterit, muisti ja niiden välissä välimuistit. Nuoli menee muistista välimuistien läpi rekistereihin. Keskellä on järjestelmätaso, jolla on laitteisto, massamuisti ja niiden välissä käyttöjärjestelmän ylläpitämä virtuaalimuisti ja levyvälimuisti. Nuoli menee massamuistista virtuaalimuistin ja levyvälimuistin läpi muistiin. Uloin alue on internet, jossa on tämä järjestelmän, pilvipalvelu/www ja niiden välissä välityspalvelin eli proxy. Nuoli pilvipalvelusta proxyn kautta massamuistiin. Laitteiston nopeus on ns-luokkaa, järjestelmän massamuistin nopeus ms-luokkaa. Pilvipalveluiden ja muun internetin nopeus on sekuntien luokkaa.\"></p><div>\n<illustrations motive=\"ch-1-3-muistihierarkia\" frombottom=\"0\" totalheight=\"100%\"></illustrations>\n</div><p>Muistihierarkiassa on kolme selkeää tasoa. Sisimpänä ovat suorittimen kanssa samalla piirikortilla toteutetut muistit, keskimmäisellä tasolla yhdessä järjestelmässä (samassa kotelossa?) olevat nopeahkot muistit. Uloimpana verkossa olevat tai samassa järjestelmässä olevat hyvin hitaat laitteet.</p><p>Kaikkien sisimpänä samalla mikropiirillä suorittimen laiterekistereiden kanssa ovat nopeimmat välimuistit. Esimerkiksi, nopeimmat tason L1 ja L2 välimuistit voivat olla toteutettuna samalla mikropiirillä suorittimen kanssa, mutta vähän hitaammat tason L3 ja L4 välimuistit voivat sijaita omilla mikropiireillään välittömästi suorittimen vieressä.</p><p>Keskusmuisti sijaitsee samalla piirikortilla (<a href=\"https://fi.wikipedia.org/wiki/Emolevy\" target=\"_blank\" rel=\"noopener noreferrer\">emolevyllä</a>) suorittimen kanssa ja on yhteydessä siihen väylän kautta. Keskusmuistin käyttö on huomattavasti (esim. 50x) hitaampaa kuin rekistereiden, mutta keskusmuisti on kooltaan huomattavasti suurempi (esim. 1 GB) kuin rekisterijoukko (esim. 0.5 MB). Välimuistiteknologian avulla keskusmuisti saadaan tuntumaan lähes yhtä nopealta kuin rekisterit.</p><div>Massamuistilaitteet (esim. kovalevy, SSD-levy, CD-levy, DVD-levy, Blu-ray-levy, USB-muistitikku) sijaitsevat samassa järjestelmässä ja niitä voi käyttää järjestelmän väylähierarkian kautta. Eri nopeuksiset väylät muodostavat hierarkian ja kullekin laitetyypille on sille sopivan nopeuksinen väylä. Hitaammat väylät liitetään erityisen sovittimen kautta nopeampiin, jotta ne eivät hidastaisi nopeampien väylien toimintaa. Massamuistit toimivat ms-aikaskaalassa eli ne ovat suuruusluokkaa 10<sup>6</sup> hitaampia kuin suoritin.</div><!-- Kuva: ch-1-1-vaylahierarkia --><p><img src=\"/78bc2e9a9a75cea9883f9a98b7d415aa/ch-1-1-vaylahierarkia.svg\" alt=\"Nopein väylä on sisäinen väylä suorittimen ja välimuistin välillä. Seuraavaksi nopein muistiväylä yhdistää välimuistin muistiin. Muistiväylässä on myös sovitin vähän hitaammalle PCI-väylälle, jossa on kiinni kovalevy. PCI-väylässä on myös sovitin vielä hitaammalle USB-väylälle, jossa on kiinni USB-muistitikku ja näppäimistö.\"></p><div>\n<illustrations motive=\"ch-1-1-vaylahierarkia\" frombottom=\"0\" totalheight=\"40%\"></illustrations>\n</div><p>Uusi flash-teknologiaan perustuva <a href=\"https://fi.wikipedia.org/wiki/SSD\" target=\"_blank\" rel=\"noopener noreferrer\">SSD</a> (Solid State Disk) -massamuisti on usein vielä toteutettu kovalevyn lailla ulkoisena massamuistina, mutta se voi sijaita myös valmiiksi asennettuna emolevyllä. SSD-massamuisti on yleensä toteutettu niin, että se näyttää samalta kuin pyörivä kovalevy, vaikka onkin selvästi nopeampi (esim. 10x). Samasta teknologiasta on myös nopeampi versio, <a href=\"https://en.wikipedia.org/wiki/NVM_Express\" target=\"_blank\" rel=\"noopener noreferrer\">NVMe</a> (NVM Express, Non-Volatile Memory). SSD:ssä (ja NVMe:ssä) on nopeuden lisäksi suurena etuna kovalevyyn verrattuna se, että siinä ei ole helposti vikaantuvia liikkuvia osia.</p><p>Ihmisen kanssa kommunikointiin tarkoitetut laitteet (esim. näppäimistö tai hiiri) kuuluvat myös järjestelmän \"sisäisiin\" laitteisiin, mutta ne ovat yleensä vielä monta kertaluokkaa hitaampia kuin massamuistit. Yleensä ihminen toimii sekunnin aikaskaalassa, mutta joiden graafisten käyttöliittymien kautta toiminta voi olla huomattavasti nopeampaa.</p><p>Järjestelmän ulkopuoliset muistit toimivat nekin sekunnin aikaskaalassa, koska tiedon siirtoon verkon läpi kuluu niin paljon aikaa. Tällaisia muistijärjestelmiä ovat organisaatioiden omat levypalvelimet ja erilaiset internetin pilvipalvelimet. Teoriassa tiedon hakeminen maapallon toiselta puolelta kestää tietenkin aika kauan aikaa, mutta käytännössä tieto haetaan useimmiten lähempänä olevasta www-välimuistista.</p><p>Jotkut järjestelmän laitteet (esim. magneettinauha) ovat yhtä hitaita kuin järjestelmän ulkopuoliset muistit ja niitä käsitellään myös samalla tavalla. Jako järjestelmän sisäisiin ja ulkoisiin laitteisiin on keinotekoinen - parempi tapa olisi luokitella laitteita niiden sijainnin mukaan väylähierarkiassa.</p><h2>Virtuaalimuisti</h2><p>Käytännössä ohjelman suorituksen aikana tiedot tulee säilyttää joko keskusmuistissa tai massamuistissa. Massamuisti on voi olla tuhat kertaa niin suuri kuin keskusmuisti, kun taas keskusmuisti voi olla miljoona kertaa niin nopea kuin massamuisti. Käyttöjärjestelmän <a href=\"https://fi.wikipedia.org/wiki/N%C3%A4enn%C3%A4ismuisti\" target=\"_blank\" rel=\"noopener noreferrer\">virtuaalimuistiteknologia</a> (virtual memory) antaa ohjelman käyttöön näennäisen muistialueen, joka on lähes yhtä nopea kuin keskusmuisti, mutta yhtä suuri kuin massamuisti.</p><p>Virtuaalimuisti on toteutettu kaikissa nykyisissä yleiskäyttöisissä käyttöjärjestelmissä (esim. Windows, Linux ja MacOS). Ratkaisu on kaksitasoinen. Kaikki ohjelman tiedot pidetään massamuistissa (virtuaalimuistin <em>tukimuistissa</em>) ja vain kulloinkin tarvittavat muistialueet pidetään keskusmuistissa. Tietoja kopioidaan yksi muistilohko eli <em>sivu</em> (page) kerrallaan aina tarvittaessa keskusmuistin ja tukimuistin välillä sillä tavoin, että lähes aina viitatut muistialueet löytyvät keskusmuistista. Ei tietenkään ole mitenkään yksinkertaista ennustaa etukäteen, mitä muistialueita kukin ohjelma tarvitsee keskusmuistiin lähitulevaisuudessa.</p><p>Jos ohjelma suoritusaikana viittaa muistipaikkaan, joka ei ole keskusmuistissa, tapahtuu <em>sivunpuutoskeskeytys</em> (page fault). Se on yksi etukäteen määritellyistä keskeytystyypeistä. Sivunpuutoskeskeytyksen yhteydessä sen aiheuttanut prosessi siirretään odotustilaan ja viitattu muistialue (ja sen lähialueita) kopioidaan tukimuistista keskusmuistiin, minkä jälkeen kyseinen prosessi pääsee takaisin suoritukseen. Tällöin se suorittaa saman konekäskyn uudelleen, mutta tällä kertaa viitattu tieto löytyy keskusmuistista. Tähän kaikkeen kuluu suhteellisesti ottaen hyvin paljon aikaa, mutta toivottavasti sivunpuutoskeskeytyksiä ei tapahdu kovin usein.</p><p>Jokaisen muistiviitteen kohdalla täytyy siis tarkistaa, onko viitattu muistialue keskusmuistissa ja missä siellä se mahdollisesti sijaitsee. Tällaista osoitteenmuunnosta ei voi tehdä yleensä ohjelmallisesti (usealla konekäskyllä), koska se hidastaisi suoritusta liikaa. Osoitteenmuunnosten tekemiseen nopeasti suorittimella (sen <a href=\"https://en.wikipedia.org/wiki/Memory_management_unit\" target=\"_blank\" rel=\"noopener noreferrer\">MMU</a>:ssa) on oma erityislaitteistonsa, <a href=\"https://en.wikipedia.org/wiki/Translation_lookaside_buffer\" target=\"_blank\" rel=\"noopener noreferrer\">TLB</a> (Translation Lookaside Buffer), joka toimii välimuistin tavoin. Useimmiten osoitteenmuunnos löytyy TLB:stä, mikä tekee virtuaalimuistijärjestelmien toiminnan mahdolliseksi. <em>TLB-hudin</em> (TLB miss) yhteydessä osoitteenmuunnos täytyy tehdä tavallisilla konekäskyillä muistissa olevia osoitteenmuunnostaulukoita (<em>sivutaulu</em> tai <em>segmenttitaulu</em>) käyttäen. Samalla tietenkin kopioidaan tehty osoitteenmuunnos TLB:hen.</p><p>Virtuaalimuistin toteutuksessa on muutamia eri tapoja. Yleensä tukimuistista kopioidaan vakiokokoisia muistilohkoja (<em>sivuja</em>) kerrallaan ja muistilohkojen koko (sivun koko) sopii hyvin yhteen käytössä olevan tukimuistin toteutukseen. Toinen vaihtoehto on tehdä kerralla kopioitavista muistilohkoista vaihtelevan kokoisia <em>segmenttejä</em>, jolloin ne taas sopivat paremmin yhteen prosessien hallinnoimien eri kokoisten muistialueiden (esim. <em>koodisegmentti</em>, <em>datasegmentti</em> tai <em>pino</em>) kanssa. Osoitteenmuunnos voidaan toteuttaa monitasoisena, jolloin siinä voi olla sekaisin <em>segmentointia</em> ja <em>sivutusta</em>. Lisäksi osoitteenmuutokseen voi liittyä aikaisemmin esitetty kanta- ja rajarekistereiden käyttö.</p><p>Virtuaalimuistin toteutukseen liittyy huomattava määrä käyttöjärjestelmän ohjelmistoa, mutta emme käsittele sitä tällä kurssilla tämän enempää. Virtuaalimuistijärjestelmän toiminta esitellään tarkemmin yliopiston käyttöjärjestelmäkurssilla.</p></div>","frontmatter":{"path":"/luku-8/1-muistihierarkia","title":"Muistihierarkia ja virtuaalimuisti"}},"allPages":{"edges":[{"node":{"id":"18ee5500-1a93-508c-8462-3d890a7a581e","frontmatter":{"path":"/arvostelu-ja-kokeet","title":"Arvostelu ja kokeet"}}},{"node":{"id":"449322c9-010e-5f88-b706-71b86dbcf229","frontmatter":{"path":"/credits","title":"Tekijänoikeudet ja lisenssit"}}},{"node":{"id":"d0cf8b2a-ba5e-5144-ab17-2183dbc79e39","frontmatter":{"path":"/opettajille","title":"Opettajille ja opinto-ohjaajille"}}},{"node":{"id":"720db14d-0aac-57f0-8dea-1f1d45ab369b","frontmatter":{"path":"/osaamistavoitteet","title":"Osaamistavoitteet"}}},{"node":{"id":"20a26b21-ef5b-55d2-a2f2-03873a068c60","frontmatter":{"path":"/","title":""}}},{"node":{"id":"c647c4d9-7b26-5dde-92cf-2c0b6ab245bf","frontmatter":{"path":"/tukivaylat","title":"Tukiväylät"}}},{"node":{"id":"2a7139bf-80e6-52c5-854b-6b697e60a67c","frontmatter":{"path":"/usein-kysytyt-kysymykset","title":"Usein kysytyt kysymykset"}}},{"node":{"id":"e2797a81-f19d-5fbc-b3f2-2d1c6541bfaf","frontmatter":{"path":"/luku-10/1-tulkitseminen-ohjelman-suoritustapana","title":"Tulkitseminen ohjelman suoritustapana"}}},{"node":{"id":"cb707bca-4404-5b81-8c54-a6e285112f42","frontmatter":{"path":"/luku-10/3-java-ohjelmien-suoritustavat","title":"Java-ohjelmien suoritustavat"}}},{"node":{"id":"fbbeb9d5-47d8-5672-acd8-b5071048e0b5","frontmatter":{"path":"/luku-10/2-java-virtuaalikone","title":"Java virtuaalikone (JVM)"}}},{"node":{"id":"2160c703-06b6-5b6c-b735-4bc48726112d","frontmatter":{"path":"/luku-10/4-emulointi-suorittimen-toteutustapana","title":"Emulointi suorittimen toteutustapana"}}},{"node":{"id":"9fa1e389-33b4-501f-b27a-d8574f90d88c","frontmatter":{"path":"/luku-10","title":"Luku 10: Tulkinta ja emulointi"}}},{"node":{"id":"3bf7644a-0bfc-5234-86ce-cd4324284a8e","frontmatter":{"path":"/luku-5/0-kertaus","title":"Perusteet-kurssin kertaus"}}},{"node":{"id":"befd446e-d2a6-54a3-8c21-5c25c35b69ef","frontmatter":{"path":"/luku-5/1-ttk-91","title":"Esimerkkitietokone ttk-91"}}},{"node":{"id":"e81b0755-960d-505b-8917-10b26f560bbb","frontmatter":{"path":"/luku-5/2-valinta-ja-toistolauseet","title":"Ohjelmoinnin peruskäsitteet sekä valinta- ja toistolauseiden toteutus"}}},{"node":{"id":"884ea86c-429d-58cb-801a-3e3f4faa07f5","frontmatter":{"path":"/luku-5/4-optimoitu-koodi","title":"Optimoitu koodi"}}},{"node":{"id":"2ab512f6-9cf8-5051-bfb6-ee1c1fd811a7","frontmatter":{"path":"/luku-5/3-rakenteinen-tieto","title":"Rakenteisen tiedon toteutus ja siihen viittaaminen"}}},{"node":{"id":"922be8ac-d049-5d41-804d-1a33d2136cf0","frontmatter":{"path":"/luku-5/5-titokone-titotrainer","title":"Titokone ja TitoTrainer"}}},{"node":{"id":"a663319d-ac43-5cca-a039-50f2a0957f36","frontmatter":{"path":"/luku-5","title":"Luku 5: Konekielinen ohjelmointi"}}},{"node":{"id":"3812cab3-1503-55b2-a2d3-84675b6ce79d","frontmatter":{"path":"/luku-6/1-aliohjelmat","title":"Aliohjelmat, parametrityypit, aktivaatiotietue (AT)"}}},{"node":{"id":"5589dc0e-45b5-530e-bd01-f70b5e6166c9","frontmatter":{"path":"/luku-6/2-akt-tiet-rakentaminen","title":"Aktivaatiotietueen rakentaminen"}}},{"node":{"id":"46e3432b-78dd-5983-987a-4ca0371bf031","frontmatter":{"path":"/luku-6/3-viiteparametrit","title":"Viiteparametrit ja ulostuloparametrit"}}},{"node":{"id":"0ee1147c-015e-5843-b858-942a5b0d33ca","frontmatter":{"path":"/luku-6/4-kj-palvelut","title":"Käyttöjärjestelmäpalvelujen käyttö"}}},{"node":{"id":"d2e3587c-8427-5cc9-979a-45c0f25d6f4b","frontmatter":{"path":"/luku-6","title":"Luku 6: Aliohjelmien toteutus"}}},{"node":{"id":"77083b55-f460-5cec-a1ce-746bd335a5f6","frontmatter":{"path":"/luku-7/1-vika-virhe-hairio","title":"Vika, virhe ja häiriö"}}},{"node":{"id":"d9fc9a0e-a6f9-5579-a1e5-06cab9086bf8","frontmatter":{"path":"/luku-7/3-muisti-cache-ssd","title":"Järjestelmän sisäisten muistien toteutus"}}},{"node":{"id":"fef01fef-b94c-5769-b39e-52e6d1d0b255","frontmatter":{"path":"/luku-7/2-tiedon-muuttumattomuus","title":"Tiedon muuttumattomuuden turvaaminen"}}},{"node":{"id":"29597c27-e1aa-52a0-a44d-73dfa913c3eb","frontmatter":{"path":"/luku-7","title":"Luku 7: Tiedon muuttumattomuus ja erilaiset muistit"}}},{"node":{"id":"9ad3d920-9960-59ca-8223-c6a68b4a9d97","frontmatter":{"path":"/luku-8/1-muistihierarkia","title":"Muistihierarkia ja virtuaalimuisti"}}},{"node":{"id":"d9007112-3ffb-5b61-b732-9ea67bb640c4","frontmatter":{"path":"/luku-8/2-tiedostot-massamuisti","title":"Tiedostojärjestelmä, tiedostot ja massamuisti"}}},{"node":{"id":"1724ec9e-2d62-51ff-8c41-113b97f504c7","frontmatter":{"path":"/luku-8/3-io-toteutus","title":"I/O:n toteutus"}}},{"node":{"id":"be08060b-e8b0-5032-abed-3a91d983d3c0","frontmatter":{"path":"/luku-8","title":"Luku 8: Ulkoisen muistin käyttö ja I/O:n toteutus"}}},{"node":{"id":"cc652698-287a-5e8d-bb09-40ef62a735f4","frontmatter":{"path":"/luku-9/1-lausekielesta-suoritukseen","title":"Lausekielestä suoritukseen"}}},{"node":{"id":"d92b88c2-3e0f-58c0-8440-864453030a8a","frontmatter":{"path":"/luku-9/2-kaantaminen","title":"Kääntäminen"}}},{"node":{"id":"5f49f9dd-29fc-50b9-88da-7f84b4c94d4d","frontmatter":{"path":"/luku-9/3-linkitys","title":"Linkitys"}}},{"node":{"id":"0a0d507b-2d34-52fc-b4eb-0df866230154","frontmatter":{"path":"/luku-9/4-lataus","title":"Lataus"}}},{"node":{"id":"5805c8b1-9b69-55c1-ad72-975455029d17","frontmatter":{"path":"/luku-9","title":"Luku 9: Käännös, linkitys ja lataus"}}}]}},"pageContext":{}},"staticQueryHashes":["2283872788","994120085"]}